name: Keep Service Alive

on:
  schedule:
    # æ¯5åˆ†é’Ÿpingä¸€æ¬¡æœåŠ¡ (é¿å…ä¼‘çœ ) - æ›´é¢‘ç¹çš„æµ‹è¯•
    - cron: '*/5 * * * *'
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  keep-alive:
    runs-on: ubuntu-latest
    
    steps:
    - name: PingæœåŠ¡ä¿æŒæ´»è·ƒ
      run: |
        # æ˜¾ç¤ºå½“å‰æ—¶é—´
        echo "ğŸ•’ å½“å‰æ—¶é—´: $(date)"
        echo "ğŸ”„ å¼€å§‹æ‰§è¡ŒKeep-aliveä»»åŠ¡"
        
        # ä½¿ç”¨æ­£ç¡®çš„RenderæœåŠ¡åœ°å€
        SERVICE_URL="https://indonesia-map-feishu-integration.onrender.com"
        
        echo "ğŸŒ æ­£åœ¨pingæœåŠ¡: $SERVICE_URL"
        
        # è¯¦ç»†çš„curlè¾“å‡º
        response=$(curl -s -w "%{http_code}" -o response_body.txt "$SERVICE_URL")
        
        echo "ğŸ“Š HTTPçŠ¶æ€ç : $response"
        
        if [ -f response_body.txt ]; then
          echo "ğŸ“„ å“åº”å†…å®¹:"
          cat response_body.txt
          rm response_body.txt
        fi
        
        if [ $response -eq 200 ]; then
          echo "âœ… æœåŠ¡è¿è¡Œæ­£å¸¸ (HTTP $response)"
        else
          echo "âš ï¸ æœåŠ¡å“åº”å¼‚å¸¸ (HTTP $response)"
          # ä¸è¦å› ä¸ºæœåŠ¡å¼‚å¸¸è€Œå¤±è´¥ï¼Œå› ä¸ºå¯èƒ½æ˜¯æœåŠ¡æ­£åœ¨å¯åŠ¨
          echo "ç»§ç»­æ‰§è¡Œï¼Œå¯èƒ½æœåŠ¡æ­£åœ¨å¯åŠ¨ä¸­"
        fi
        
        echo "âœ… Keep-aliveä»»åŠ¡å®Œæˆ" 