=== é£ä¹¦å¤šç»´è¡¨æ ¼è‡ªåŠ¨åŒ–è„šæœ¬ ===

å°†ä»¥ä¸‹ä»£ç å¤åˆ¶åˆ°é£ä¹¦å¤šç»´è¡¨æ ¼çš„è‡ªåŠ¨åŒ–è„šæœ¬ä¸­ï¼š

```javascript
async function main(event) {
    // GitHubé…ç½®ä¿¡æ¯
    const GITHUB_CONFIG = {
        owner: 'AlimanIrawan',           // GitHubç”¨æˆ·å
        repo: 'indonesia-map-app',       // ä»“åº“å
        path: 'public/markers.csv',      // CSVæ–‡ä»¶è·¯å¾„
        token: 'YOUR_GITHUB_TOKEN_HERE', // éœ€è¦æ›¿æ¢ä¸ºå®é™…çš„GitHub Token
        branch: 'main'                   // åˆ†æ”¯å
    };
    
    try {
        console.log('ğŸš€ å¼€å§‹å¤„ç†é£ä¹¦æ•°æ®æ¨é€...');
        
        // è·å–è§¦å‘çš„è®°å½•æ•°æ®
        const record = event.record;
        const recordId = record.recordId;
        
        // æå–å­—æ®µæ•°æ®å¹¶å¤„ç†
        const extractFieldValue = (field) => {
            if (!field) return '';
            if (Array.isArray(field)) return field[0]?.text || '';
            if (typeof field === 'object' && field.text) return field.text;
            return String(field).trim();
        };
        
        // æ ¹æ®æ‚¨çš„é£ä¹¦è¡¨æ ¼å­—æ®µåæå–æ•°æ®
        const newData = {
            shop_code: extractFieldValue(record.fields['Outlet Code']),
            latitude: extractFieldValue(record.fields['latitude']),
            longitude: extractFieldValue(record.fields['longitude']),
            outlet_name: extractFieldValue(record.fields['Nama Pemilik']),
            brand: extractFieldValue(record.fields['brand']) || '',
            kecamatan: extractFieldValue(record.fields['kecamatan']) || '',
            potensi: extractFieldValue(record.fields['potensi']) || ''
        };
        
        console.log('ğŸ“Š æå–çš„æ•°æ®:', newData);
        
        // éªŒè¯å¿…å¡«å­—æ®µ
        if (!newData.shop_code || !newData.latitude || !newData.longitude) {
            throw new Error('ç¼ºå°‘å¿…å¡«å­—æ®µï¼šshop_codeã€latitudeæˆ–longitude');
        }
        
        // éªŒè¯ç»çº¬åº¦æ ¼å¼
        const lat = parseFloat(newData.latitude);
        const lng = parseFloat(newData.longitude);
        if (isNaN(lat) || isNaN(lng)) {
            throw new Error(`ç»çº¬åº¦æ ¼å¼æ— æ•ˆ: ${newData.latitude}, ${newData.longitude}`);
        }
        
        // ç¬¬ä¸€æ­¥ï¼šè·å–å½“å‰CSVæ–‡ä»¶å†…å®¹
        console.log('ğŸ“¥ è·å–å½“å‰CSVæ–‡ä»¶...');
        const getCurrentFile = await fetch(
            `https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${GITHUB_CONFIG.path}`,
            {
                method: 'GET',
                headers: {
                    'Authorization': `token ${GITHUB_CONFIG.token}`,
                    'Accept': 'application/vnd.github.v3+json'
                }
            }
        );
        
        if (!getCurrentFile.ok) {
            throw new Error(`è·å–æ–‡ä»¶å¤±è´¥: ${getCurrentFile.status}`);
        }
        
        const fileData = await getCurrentFile.json();
        const currentContent = atob(fileData.content.replace(/\s/g, ''));
        const currentSha = fileData.sha;
        
        console.log('âœ… æˆåŠŸè·å–å½“å‰æ–‡ä»¶å†…å®¹');
        
        // ç¬¬äºŒæ­¥ï¼šè§£æCSVå¹¶å¤„ç†æ•°æ®
        const lines = currentContent.split('\n');
        const headers = lines[0];
        let dataLines = lines.slice(1).filter(line => line.trim() !== '');
        
        // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒshop_codeçš„è®°å½•
        const existingIndex = dataLines.findIndex(line => {
            const fields = line.split(',');
            return fields[0] === newData.shop_code;
        });
        
        // æ„å»ºæ–°çš„CSVè¡Œ
        const newCsvLine = [
            newData.shop_code,
            newData.latitude,
            newData.longitude,
            `"${newData.outlet_name}"`,
            newData.brand,
            newData.kecamatan,
            newData.potensi
        ].join(',');
        
        if (existingIndex >= 0) {
            // æ›´æ–°ç°æœ‰è®°å½•
            dataLines[existingIndex] = newCsvLine;
            console.log('ğŸ”„ æ›´æ–°ç°æœ‰è®°å½•:', newData.shop_code);
        } else {
            // æ·»åŠ æ–°è®°å½•
            dataLines.push(newCsvLine);
            console.log('â• æ·»åŠ æ–°è®°å½•:', newData.shop_code);
        }
        
        // é‡æ–°ç»„è£…CSVå†…å®¹
        const newContent = [headers, ...dataLines].join('\n');
        
        // ç¬¬ä¸‰æ­¥ï¼šæ›´æ–°GitHubæ–‡ä»¶
        console.log('ğŸ“¤ æ›´æ–°GitHubæ–‡ä»¶...');
        const updateResponse = await fetch(
            `https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${GITHUB_CONFIG.path}`,
            {
                method: 'PUT',
                headers: {
                    'Authorization': `token ${GITHUB_CONFIG.token}`,
                    'Accept': 'application/vnd.github.v3+json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    message: `è‡ªåŠ¨æ›´æ–°æ•°æ®: ${newData.outlet_name} (${newData.shop_code})`,
                    content: btoa(newContent),
                    sha: currentSha,
                    branch: GITHUB_CONFIG.branch
                })
            }
        );
        
        if (!updateResponse.ok) {
            const errorData = await updateResponse.json();
            throw new Error(`æ›´æ–°æ–‡ä»¶å¤±è´¥: ${updateResponse.status} - ${errorData.message}`);
        }
        
        const updateResult = await updateResponse.json();
        console.log('âœ… æˆåŠŸæ›´æ–°GitHubæ–‡ä»¶');
        console.log('ğŸ”— æäº¤é“¾æ¥:', updateResult.commit.html_url);
        
        // è¿”å›æˆåŠŸç»“æœ
        return {
            success: true,
            message: `æ•°æ®å·²æˆåŠŸåŒæ­¥åˆ°GitHub`,
            shop_code: newData.shop_code,
            commit_url: updateResult.commit.html_url
        };
        
    } catch (error) {
        console.error('âŒ è‡ªåŠ¨åŒ–è„šæœ¬æ‰§è¡Œå¤±è´¥:', error);
        
        // è¿”å›é”™è¯¯ä¿¡æ¯
        return {
            success: false,
            error: error.message,
            timestamp: new Date().toISOString()
        };
    }
}
```

=== ä½¿ç”¨è¯´æ˜ ===

1. **åˆ›å»ºGitHub Personal Access Token**ï¼š
   - è®¿é—®ï¼šhttps://github.com/settings/tokens
   - ç‚¹å‡»"Generate new token (classic)"
   - æƒé™é€‰æ‹©ï¼šrepo (Full control of private repositories)
   - å¤åˆ¶ç”Ÿæˆçš„token

2. **åœ¨é£ä¹¦ä¸­è®¾ç½®è‡ªåŠ¨åŒ–**ï¼š
   - æ‰“å¼€å¤šç»´è¡¨æ ¼ â†’ è‡ªåŠ¨åŒ– â†’ åˆ›å»ºè‡ªåŠ¨åŒ–
   - è§¦å‘å™¨ï¼šæ–°å¢/ä¿®æ”¹è®°å½•æ—¶
   - æ‰§è¡ŒåŠ¨ä½œï¼šä»£ç æ‰§è¡Œ
   - å°†ä¸Šè¿°è„šæœ¬å¤åˆ¶ç²˜è´´åˆ°ä»£ç åŒºåŸŸ
   - å°† 'YOUR_GITHUB_TOKEN_HERE' æ›¿æ¢ä¸ºå®é™…çš„token

3. **å­—æ®µåæ˜ å°„**ï¼š
   ç¡®ä¿é£ä¹¦è¡¨æ ¼ä¸­çš„å­—æ®µåä¸è„šæœ¬ä¸­çš„ä¸€è‡´ï¼š
   - Outlet Code â†’ shop_code
   - latitude â†’ çº¬åº¦
   - longitude â†’ ç»åº¦  
   - Nama Pemilik â†’ åº—é“ºåç§°
   - brand â†’ å“ç‰Œ
   - kecamatan â†’ åŒºåŸŸ
   - potensi â†’ æ½œåŠ›æ ‡è®°

4. **æµ‹è¯•è‡ªåŠ¨åŒ–**ï¼š
   - ä¿å­˜å¹¶å¯ç”¨è‡ªåŠ¨åŒ–
   - åœ¨è¡¨æ ¼ä¸­æ·»åŠ /ä¿®æ”¹ä¸€æ¡è®°å½•
   - æ£€æŸ¥GitHubä»“åº“æ˜¯å¦è‡ªåŠ¨æ›´æ–°

æ³¨æ„ï¼šGitHub APIæœ‰é€Ÿç‡é™åˆ¶ï¼Œå»ºè®®ä¸è¦è¿‡äºé¢‘ç¹åœ°è§¦å‘æ›´æ–°ã€‚ 